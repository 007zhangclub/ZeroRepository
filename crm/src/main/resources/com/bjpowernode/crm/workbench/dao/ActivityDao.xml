<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bjpowernode.crm.workbench.dao.ActivityDao">
    <sql id="star">
        id
        ,
        owner,
        name,
        startDate,
        endDate,
        cost,
        description,
        createTime,
        createBy,
        editTime,
        editBy,
        isDelete
    </sql>
    <sql id="starValues">
        #{id}
        ,
        #{owner},
        #{name},
        #{startDate},
        #{endDate},
        #{cost},
        #{description},
        #{createTime},
        #{createBy},
        #{editTime},
        #{editBy},
        #{isDelete}
    </sql>

    <sql id="listValues">
        #{a.id},
        #{a.owner},
        #{a.name},
        #{a.startDate},
        #{a.endDate},
        #{a.cost},
        #{a.description},
        #{a.createTime},
        #{a.createBy},
        #{a.editTime},
        #{a.editBy},
        #{a.isDelete}
    </sql>
    <insert id="insert">
        insert into tbl_activity
        (
        <include refid="star"/>
        )
        values
        (
        <include refid="starValues"/>
        )
    </insert>
    <insert id="insertList">
        insert into tbl_activity
        (
        <include refid="star"/>
        )
        values
               <foreach collection="list" separator="," item="a">
                   (
                   <include refid="listValues"/>
                   )
               </foreach>
    </insert>
    <update id="update">
        update tbl_activity
        <set>
            <if test="owner != null and owner != ''">
                owner = #{owner} ,
            </if>
            <if test="name != null and name != ''">
                name = #{name} ,
            </if>
            <if test="startDate != null and startDate != ''">
                startDate = #{startDate} ,
            </if>
            <if test="endDate != null and endDate != ''">
                endDate = #{endDate} ,
            </if>
            <if test="cost != null and cost != ''">
                cost = #{cost} ,
            </if>
            <if test="description != null and description != ''">
                description = #{description} ,
            </if>
            <if test="editBy != null and editBy != ''">
                editBy = #{editBy} ,
            </if>
            <if test="editTime != null and editTime != ''">
                editTime = #{editTime} ,
            </if>
        </set>
            where id = #{id}
    </update>
    <update id="updateIsDelete">
        update tbl_activity set isDelete = #{isDelete}, editTime = #{editTime}, editBy = #{editBy} where id = #{id}
    </update>
    <select id="findPage" resultType="com.bjpowernode.crm.workbench.domain.Activity">
        select a.*,u.name username from tbl_activity a left join tbl_user u on a.owner = u.id
        <where>
            a.isDelete = '0'
            <if test="name != null and name != ''">
                and a.name like '%' #{name} '%'
            </if>

            <if test="owner != null and owner != ''">
                and u.name = #{owner}
            </if>

            <if test="startDate != null and startDate != ''">
                and a.startDate &gt;= #{startDate}
            </if>

            <if test="endDate != null and endDate != ''">
                and a.endDate &lt;= #{endDate}
            </if>
        </where>
        limit #{pageNo},#{pageSize}
    </select>
    <select id="findPageCount" resultType="java.lang.Integer">
        select count(a.id) from tbl_activity a left join tbl_user u on a.owner = u.id
        <where>
            a.isDelete = '0'
            <if test="name != null and name != ''">
                and a.name like '%' #{name} '%'
            </if>

            <if test="owner != null and owner != ''">
                and u.name = #{owner}
            </if>

            <if test="startDate != null and startDate != ''">
                and a.startDate &gt;= #{startDate}
            </if>

            <if test="endDate != null and endDate != ''">
                and a.endDate &lt;= #{endDate}
            </if>
        </where>
    </select>
    <select id="findById" resultType="com.bjpowernode.crm.workbench.domain.Activity">
        select a.*, u.name username
        from tbl_activity a
                 left join tbl_user u on a.owner = u.id
        where a.id = #{id}
    </select>
</mapper>